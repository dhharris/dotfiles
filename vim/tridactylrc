" Modified from bovine3dom's dogfood

" May require the latest beta builds.

" Move this to $XDG_CONFIG_DIR/tridactyl/tridactylrc (that's
" ~/.config/tridactyl/tridactylrc to mere mortals) or ~/.tridactylrc and
" install the native messenger (:installnative in Tridactyl). Run :source to
" get it in the browser, or just restart.

" NB: If you want "vim-like" behaviour where removing a line from
" here makes the setting disappear, uncomment the line below.

sanitise tridactyllocal tridactylsync

"
" Binds
"

" Only hint search results on Google
bindurl www.google.com f hint -Jc .rc > .r > a
bindurl www.google.com F hint -Jtc .rc>.r>a

" Allow Ctrl-a to select all in the commandline
unbind --mode=ex <C-a>

" Allow Ctrl-c to copy in the commandline
unbind --mode=ex <C-c>

" Handy multiwindow/multitasking binds
bind gd tabdetach
bind gD composite tabduplicate | tabdetach

" Make yy use canonical / short links on the 5 websites that support them
bind yy clipboard yankshort

" Stupid workaround to let hint -; be used with composite which steals semi-colons
command hint_focus hint -;

" Open right click menu on links
bind ;C composite hint_focus; !s xdotool key Menu

" vim-like find behavior
bind / fillcmdline find
bind n findnext 1
bind N findnext -1
bind <space> nohlsearch

" Open current page in the wayback machine
command wayback composite get_current_url | tabopen https://web.archive.org/web/*/


"
" Ignore tridactyl input on these sites.
" Can be turned back on using :mode normal
"
autocmd DocStart facebook.com/intern/am mode ignore
autocmd DocStart studieskolen.danishtogo.dk mode ignore

"
" Custom Search Engines
"
set searchurls.g https://www.google.com/search?q=%s
set searchurls.osw https://oldschool.runescape.wiki/w/Special:Search?search=%s
set searchurls.libgen http://gen.lib.rus.ec/search.php?req=%s
set searchurls.archive https://archive.org/search.php?query=%s

"
" Misc settings
"

" set editorcmd to suckless terminal, or use the defaults on other platforms
js tri.browserBg.runtime.getPlatformInfo().then(os=>{const editorcmd = os.os=="linux" ? "st vim" : "auto"; tri.config.set("editorcmd", editorcmd)})

" set profile dir on Windows
jsb browser.runtime.getPlatformInfo().then(os=>{const profiledir = os.os=="win" ? "C:\\Users\\olie\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\gwm76nmk.default" : "auto"; tri.config.set("profiledir", profiledir)})

" Sane hinting mode
set hintfiltermode vimperator-reflow
set hintnames numeric

" Defaults to 300ms but I'm a 'move fast and close the wrong tabs' kinda chap
set hintdelay 100

" Disallow new tabs from stealing focus. Breaks JS editors like coderpad.
" See tridactyl FAQ
set allowautofocus false
seturl coderpad.io allowautofocus true

"
" URL redirects
"

" New reddit is bad
autocmd DocStart ^http(s?)://www.reddit.com js tri.excmds.urlmodify("-t", "www", "old")
" Mosquito nets won't make themselves
autocmd DocStart ^http(s?)://www.amazon.com js tri.excmds.urlmodify("-t", "www", "smile")
" Don't use fandom RS wiki
autocmd DocStart ^http(s?)://oldschoolrunescape.fandom.com js tri.excmds.urlmodify("-t", "oldschoolrunescape.fandom.com", "oldschool.runescape.wiki")

" This will have to do until someone writes us a nice syntax file :)
" vim: set filetype=vim:
